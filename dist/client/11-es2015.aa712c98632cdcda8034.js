(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{"+XkY":function(e,t,i){"use strict";i.r(t),i.d(t,"LazyOkapsRegisterComponent",(function(){return _}));var a=i("nIj0"),s=i("YtkY"),r=i("C05f"),c=i("kgbq"),n=i("2kYt"),o=i("UCkh");function l(e=8){return t=>function(e,t){const{value:i}=e;let a=i.length>=t;return a?(a=/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[#$^+=!*()@%&]).{8,}$/.test(i),a?null:{invalidPassword:!0,message:"\u041f\u0430\u0440\u043e\u043b\u044c \u0434\u043e\u043b\u0436\u0435\u043d \u0441\u043e\u0434\u0435\u0440\u0436\u0430\u0442\u044c \u0442\u043e\u043b\u044c\u043a\u043e \u043b\u0430\u0442\u0438\u043d\u0441\u043a\u0438\u0435 \u0441\u0438\u043c\u0432\u043e\u043b\u044b, \u0446\u0438\u0444\u0440\u044b \u0438 \u0441\u043f\u0435\u0446\u0438\u0430\u043b\u044c\u043d\u044b\u0439 \u0441\u0438\u043c\u0432\u043e\u043b (#$^+=!*()@%&)"}):{invalidPassword:!0,message:`\u041f\u0430\u0440\u043e\u043b\u044c \u0434\u043e\u043b\u0436\u0435\u043d \u0441\u043e\u0434\u0435\u0440\u0436\u0430\u0442\u044c \u043d\u0435 \u043c\u0435\u043d\u0435\u0435 ${t} \u0441\u0438\u043c\u0432\u043e\u043b\u043e\u0432 \u0438 \u0446\u0438\u0444\u0440`}}(t,e)}var m=i("Ns5P");const b=(e,t)=>{const i=e.find(e=>e.startsWith(t));return i?i.substr(t.length):null};i("easA");var d=i("w4gY"),u=i("vQRv"),g=i("EM62"),f=i("W1gw"),p=i("lGQG"),h=i("rvT1"),v=i("OZ4H"),C=i("Ebh2"),w=i("KBE0"),T=i("x9Az"),I=i("xzWC"),U=i("zmEM"),D=i("29Wa"),F=i("Cd2c"),N=i("3lkL"),k=i("bFHC"),O=i("+Tre"),y=i("PBFl");function P(e,t){1&e&&(g.Ub(0,"mat-icon"),g.Dc(1,"done"),g.Tb())}function E(e,t){if(1&e&&g.Dc(0),2&e){const e=g.gc().ngIf;g.Ec(e.certificate)}}function S(e,t){if(1&e&&g.Dc(0),2&e){const e=g.gc().ngIf;g.Ec(e.information)}}function $(e,t){if(1&e&&(g.Ub(0,"mat-hint",22),g.Dc(1),g.Tb()),2&e){const e=g.gc().ngIf;g.mc("@fadeIn",void 0),g.Cb(1),g.Fc(" ",e.emailHint," ")}}function L(e,t){if(1&e&&(g.Ub(0,"mat-hint",22),g.Dc(1),g.Tb()),2&e){const e=g.gc(2);g.mc("@fadeIn",void 0),g.Cb(1),g.Fc(" ",e.password().errors.message," ")}}function x(e,t){if(1&e&&(g.Ub(0,"mat-hint",22),g.Dc(1),g.Tb()),2&e){const e=g.gc().ngIf;g.mc("@fadeIn",void 0),g.Cb(1),g.Fc(" ",e.passwordHint," ")}}function B(e,t){if(1&e){const e=g.Vb();g.Ub(0,"mat-checkbox",23),g.cc("click",(function(){return g.vc(e),g.gc(2)._agreement()})),g.Dc(1),g.Tb()}if(2&e){const e=g.gc().ngIf,t=g.gc();g.mc("formControl",t.personalDataUsage),g.Cb(1),g.Ec(e.agreement)}}function M(e,t){if(1&e){const e=g.Vb();g.Ub(0,"div",24),g.Ub(1,"button",25),g.cc("click",(function(){return g.vc(e),g.gc(2).register()})),g.hc(2,"async"),g.Dc(3),g.Tb(),g.Tb()}if(2&e){const e=g.gc().ngIf,t=g.gc();g.Cb(1),g.mc("disabled",g.ic(2,2,t.loading$)),g.Cb(2),g.Fc(" ",e.register," ")}}function j(e,t){if(1&e){const e=g.Vb();g.Sb(0),g.Pb(1,"app-dialog-title",1),g.hc(2,"async"),g.Ub(3,"div",2),g.Ub(4,"mat-vertical-stepper",3,4),g.cc("selectionChange",(function(t){return g.vc(e),g.gc().selectedIndex=t.selectedIndex})),g.Bc(6,P,2,0,"ng-template",5),g.Ub(7,"mat-step",6),g.Bc(8,E,1,1,"ng-template",7),g.Ub(9,"form",8),g.Ub(10,"app-certificate",9),g.cc("certificateLoading",(function(t){return g.vc(e),g.gc().certLoading=t}))("certificateLoaded",(function(t){g.vc(e);const i=g.tc(5);return g.gc().certificateLoaded(t,i)})),g.Tb(),g.Tb(),g.Tb(),g.Ub(11,"mat-step",6),g.Bc(12,S,1,1,"ng-template",7),g.Ub(13,"p"),g.Dc(14),g.Tb(),g.Ub(15,"p"),g.Dc(16),g.Tb(),g.Ub(17,"p"),g.Dc(18),g.Tb(),g.Pb(19,"mat-divider"),g.Ub(20,"form",10),g.cc("ngSubmit",(function(){return g.vc(e),g.gc().register()})),g.Ub(21,"div",11),g.Ub(22,"div",12),g.Ub(23,"mat-form-field",13),g.Ub(24,"mat-label"),g.Dc(25),g.Tb(),g.Pb(26,"input",14),g.Bc(27,$,2,2,"mat-hint",15),g.Tb(),g.Tb(),g.Ub(28,"div",12),g.Ub(29,"mat-form-field",13),g.Ub(30,"mat-label"),g.Dc(31),g.Tb(),g.Pb(32,"input",16),g.Tb(),g.Tb(),g.Ub(33,"div",12),g.Ub(34,"mat-form-field",13),g.Ub(35,"mat-label"),g.Dc(36),g.Tb(),g.Pb(37,"input",17),g.Bc(38,L,2,2,"mat-hint",15),g.Tb(),g.Tb(),g.Ub(39,"div",12),g.Ub(40,"mat-form-field",13),g.Ub(41,"mat-label"),g.Dc(42),g.Tb(),g.Pb(43,"input",18),g.Bc(44,x,2,2,"mat-hint",19),g.Tb(),g.Tb(),g.Tb(),g.Tb(),g.Tb(),g.Tb(),g.Tb(),g.Bc(45,B,2,2,"mat-checkbox",20),g.Bc(46,M,4,4,"div",21),g.Rb()}if(2&e){const e=t.ngIf,i=g.gc();g.Cb(1),g.mc("readonly",g.ic(2,22,i.loading$))("title",e.register),g.Cb(3),g.mc("linear",!0),g.Cb(3),g.mc("stepControl",i.certificateForm),g.Cb(2),g.mc("formGroup",i.certificateForm),g.Cb(2),g.mc("stepControl",i.registerForm),g.Cb(3),g.Hc(" ",i.lastName().value," ",i.firstName().value," ",i.middleName().value," "),g.Cb(2),g.Ec(i.iin().value),g.Cb(2),g.Ec(i.certificateDateRange()),g.Cb(2),g.mc("formGroup",i.registerForm),g.Cb(5),g.Ec(e.email),g.Cb(2),g.mc("ngIf",i.email().errors&&i.email().errors.email),g.Cb(4),g.Ec(e.phone),g.Cb(1),g.mc("showMaskTyped",!0),g.Cb(4),g.Ec(e.password),g.Cb(2),g.mc("ngIf",i.password().errors&&i.password().errors.invalidPassword),g.Cb(4),g.Ec(e.confirmPassword),g.Cb(2),g.mc("ngIf",i.confirmPassword().touched&&i.confirmPassword().value!==i.password().value),g.Cb(1),g.mc("ngIf",1===i.selectedIndex),g.Cb(1),g.mc("ngIf",1===i.selectedIndex)}}let _=(()=>{class e{constructor(e,t,i,o,g,f,p){this.fb=e,this.snackbar=t,this.authService=i,this.locale=o,this.ref=g,this.dialog=f,this.loader=p,this.loading$$=new r.a(!1),this.loading$=this.loading$$.asObservable(),this.certLoading=!1,this.personalDataUsage=new a.e(!1),this.agreementSubsciption=null,this.registerSubsciption=null,this._agreement=()=>{null!==this.agreementSubsciption&&this.agreementSubsciption.unsubscribe(),this.agreementSubsciption=this.dialog.open(d.a,{disableClose:!0,hasBackdrop:!0,autoFocus:!0,panelClass:["d-lg","xl-md"],data:{method:this.loader.loadAgreementComponent,iin:this.iin().value,lastName:this.lastName().value,firstName:this.firstName().value,middleName:this.middleName().value}}).afterClosed().subscribe(e=>{e?(this.agreementId().setValue(e),this.personalDataUsage.setValue(!0)):this.personalDataUsage.setValue(!1)})},this.certificateLoaded=(e,t)=>{this.responseObject().setValue(e),this._mapToFormValues(t)},this.register=()=>{if(!this.personalDataUsage.value||""===this.agreementId().value)return this.snackbar.open(this._personalDataUsageMessage);this.registerForm.valid?(null!==this.registerSubsciption&&this.registerSubsciption.unsubscribe(),this._setLoading(!0),this.registerSubsciption=this.authService.registerUser(this.registerForm.value).pipe(Object(s.a)(e=>{this.snackbar.open(this._successMessage),this.ref.close()})).subscribe(c.a,()=>{this._setLoading(!1)})):this.registerForm.markAllAsTouched()},this.responseObject=()=>this.certificateForm.get("responseObject"),this.iin=()=>this.registerForm.get("identifier"),this.email=()=>this.registerForm.get("email"),this.lastName=()=>this.registerForm.get("lastName"),this.firstName=()=>this.registerForm.get("firstName"),this.middleName=()=>this.registerForm.get("middleName"),this.password=()=>this.registerForm.get("password"),this.confirmPassword=()=>this.registerForm.get("confirmPassword"),this.agreementId=()=>this.registerForm.get("agreementId"),this.certificateDateTo=()=>this.registerForm.get("certificateDateTo"),this.certificateDateFrom=()=>this.registerForm.get("certificateDateFrom"),this.certificateDateRange=()=>{const e=this.certificateDateFrom().value,t=this.certificateDateTo().value;return e&&t?`${Object(n.u)(e,"dd/MM/yy","en")} - ${Object(n.u)(t,"dd/MM/yy","en")}`:""},this._initializeForms=()=>{this.certificateForm=this.fb.group({responseObject:["",a.u.required]}),this.registerForm=this.fb.group({identifier:["",Object(u.a)()],lastName:[""],firstName:["",a.u.required],middleName:[""],email:["",[a.u.required,a.u.email]],phoneNumber:["",a.u.required],password:["",l(8)],confirmPassword:["",a.u.required],certificateDateFrom:["",a.u.required],certificateDateTo:["",a.u.required],essenceType:["",a.u.required],agreementId:["",a.u.required]})},this._mapToFormValues=e=>{const t=(({subjectDn:e,certNotAfter:t,certNotBefore:i})=>{var a;if(!e)return;const s=e.split(","),r=b(s,"CN=");return{identifier:b(s,"SERIALNUMBER=IIN"),middleName:b(s,"G="),lastName:b(s,"SURNAME="),firstName:r?r.split(" ")[1]:"",email:null===(a=b(s,"E="))||void 0===a?void 0:a.toLowerCase(),certificateDateFrom:i?new Date(+i):null,certificateDateTo:t?new Date(+t):null,essenceType:m.b.Individual}})(this.responseObject().value);this.registerForm.patchValue(t),this.responseObject().valid&&e&&e.next()}}ngOnInit(){this._initializeForms(),this.locale$=this.locale.register().pipe(Object(s.a)(e=>(this._successMessage=e.success,this._personalDataUsageMessage=e.personalDataUsage,e)))}_setLoading(e){this.loading$$.next(e)}}return e.\u0275fac=function(t){return new(t||e)(g.Ob(a.d),g.Ob(f.b),g.Ob(p.a),g.Ob(h.a),g.Ob(v.h),g.Ob(v.c),g.Ob(C.a))},e.\u0275cmp=g.Ib({type:e,selectors:[["app-okaps-register"]],decls:2,vars:3,consts:[[4,"ngIf"],[3,"readonly","title"],["mat-dialog-content","",1,"px-0","position-relative"],[3,"linear","selectionChange"],["stepper",""],["matStepperIcon","edit"],[3,"stepControl"],["matStepLabel",""],["autocomplete","off",3,"formGroup"],[3,"certificateLoading","certificateLoaded"],["autocomplete","off",3,"formGroup","ngSubmit"],[1,"row","mt-3"],[1,"col-12","mb-2"],["appearance","fill"],["autocomplete","email","type","email","matInput","","formControlName","email"],["align","end","class","warn",4,"ngIf"],["matInput","","formControlName","phoneNumber","mask","(000) 000 00 00","prefix","+7",3,"showMaskTyped"],["autocomplete","new-password","type","password","matInput","","formControlName","password"],["autocomplete","new-password","type","password","matInput","","formControlName","confirmPassword"],["class","warn","align","end",4,"ngIf"],[3,"formControl","click",4,"ngIf"],["mat-dialog-actions","","class","mb-2",4,"ngIf"],["align","end",1,"warn"],[3,"formControl","click"],["mat-dialog-actions","",1,"mb-2"],["mat-flat-button","","color","primary","type","button",1,"w-xs-100",3,"disabled","click"]],template:function(e,t){1&e&&(g.Bc(0,j,47,24,"ng-container",0),g.hc(1,"async")),2&e&&g.mc("ngIf",g.ic(1,1,t.locale$))},directives:[n.l,w.a,v.f,T.e,T.c,T.a,T.b,a.v,a.p,a.i,I.a,U.a,D.b,D.f,F.b,a.b,a.o,a.g,N.a,k.a,D.e,O.a,a.f,v.d,y.b],pipes:[n.b],styles:[""],data:{animation:[o.b]}}),e})()}}]);