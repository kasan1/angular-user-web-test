function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass(e,t,a){return t&&_defineProperties(e.prototype,t),a&&_defineProperties(e,a),e}(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{"+XkY":function(e,t,a){"use strict";a.r(t),a.d(t,"LazyOkapsRegisterComponent",(function(){return q}));var r=a("nIj0"),i=a("YtkY"),n=a("C05f"),c=a("kgbq"),o=a("2kYt"),s=a("UCkh");function l(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:8;return function(t){return function(e,t){var a=e.value,r=a.length>=t;return r?(r=/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[#$^+=!*()@%&]).{8,}$/.test(a))?null:{invalidPassword:!0,message:"\u041f\u0430\u0440\u043e\u043b\u044c \u0434\u043e\u043b\u0436\u0435\u043d \u0441\u043e\u0434\u0435\u0440\u0436\u0430\u0442\u044c \u0442\u043e\u043b\u044c\u043a\u043e \u043b\u0430\u0442\u0438\u043d\u0441\u043a\u0438\u0435 \u0441\u0438\u043c\u0432\u043e\u043b\u044b, \u0446\u0438\u0444\u0440\u044b \u0438 \u0441\u043f\u0435\u0446\u0438\u0430\u043b\u044c\u043d\u044b\u0439 \u0441\u0438\u043c\u0432\u043e\u043b (#$^+=!*()@%&)"}:{invalidPassword:!0,message:"\u041f\u0430\u0440\u043e\u043b\u044c \u0434\u043e\u043b\u0436\u0435\u043d \u0441\u043e\u0434\u0435\u0440\u0436\u0430\u0442\u044c \u043d\u0435 \u043c\u0435\u043d\u0435\u0435 ".concat(t," \u0441\u0438\u043c\u0432\u043e\u043b\u043e\u0432 \u0438 \u0446\u0438\u0444\u0440")}}(t,e)}}var u=a("Ns5P"),m=function(e,t){var a=e.find((function(e){return e.startsWith(t)}));return a?a.substr(t.length):null};a("easA");var b=a("w4gY"),f=a("vQRv"),d=a("EM62"),g=a("W1gw"),p=a("lGQG"),v=a("rvT1"),h=a("OZ4H"),C=a("Ebh2"),w=a("KBE0"),T=a("x9Az"),I=a("xzWC"),U=a("zmEM"),D=a("29Wa"),F=a("Cd2c"),N=a("3lkL"),k=a("bFHC"),y=a("+Tre"),O=a("PBFl");function P(e,t){1&e&&(d.Ub(0,"mat-icon"),d.Dc(1,"done"),d.Tb())}function _(e,t){if(1&e&&d.Dc(0),2&e){var a=d.gc().ngIf;d.Ec(a.certificate)}}function E(e,t){if(1&e&&d.Dc(0),2&e){var a=d.gc().ngIf;d.Ec(a.information)}}function S(e,t){if(1&e&&(d.Ub(0,"mat-hint",22),d.Dc(1),d.Tb()),2&e){var a=d.gc().ngIf;d.mc("@fadeIn",void 0),d.Cb(1),d.Fc(" ",a.emailHint," ")}}function L(e,t){if(1&e&&(d.Ub(0,"mat-hint",22),d.Dc(1),d.Tb()),2&e){var a=d.gc(2);d.mc("@fadeIn",void 0),d.Cb(1),d.Fc(" ",a.password().errors.message," ")}}function j(e,t){if(1&e&&(d.Ub(0,"mat-hint",22),d.Dc(1),d.Tb()),2&e){var a=d.gc().ngIf;d.mc("@fadeIn",void 0),d.Cb(1),d.Fc(" ",a.passwordHint," ")}}function x(e,t){if(1&e){var a=d.Vb();d.Ub(0,"mat-checkbox",23),d.cc("click",(function(){return d.vc(a),d.gc(2)._agreement()})),d.Dc(1),d.Tb()}if(2&e){var r=d.gc().ngIf,i=d.gc();d.mc("formControl",i.personalDataUsage),d.Cb(1),d.Ec(r.agreement)}}function B(e,t){if(1&e){var a=d.Vb();d.Ub(0,"div",24),d.Ub(1,"button",25),d.cc("click",(function(){return d.vc(a),d.gc(2).register()})),d.hc(2,"async"),d.Dc(3),d.Tb(),d.Tb()}if(2&e){var r=d.gc().ngIf,i=d.gc();d.Cb(1),d.mc("disabled",d.ic(2,2,i.loading$)),d.Cb(2),d.Fc(" ",r.register," ")}}function M(e,t){if(1&e){var a=d.Vb();d.Sb(0),d.Pb(1,"app-dialog-title",1),d.hc(2,"async"),d.Ub(3,"div",2),d.Ub(4,"mat-vertical-stepper",3,4),d.cc("selectionChange",(function(e){return d.vc(a),d.gc().selectedIndex=e.selectedIndex})),d.Bc(6,P,2,0,"ng-template",5),d.Ub(7,"mat-step",6),d.Bc(8,_,1,1,"ng-template",7),d.Ub(9,"form",8),d.Ub(10,"app-certificate",9),d.cc("certificateLoading",(function(e){return d.vc(a),d.gc().certLoading=e}))("certificateLoaded",(function(e){d.vc(a);var t=d.tc(5);return d.gc().certificateLoaded(e,t)})),d.Tb(),d.Tb(),d.Tb(),d.Ub(11,"mat-step",6),d.Bc(12,E,1,1,"ng-template",7),d.Ub(13,"p"),d.Dc(14),d.Tb(),d.Ub(15,"p"),d.Dc(16),d.Tb(),d.Ub(17,"p"),d.Dc(18),d.Tb(),d.Pb(19,"mat-divider"),d.Ub(20,"form",10),d.cc("ngSubmit",(function(){return d.vc(a),d.gc().register()})),d.Ub(21,"div",11),d.Ub(22,"div",12),d.Ub(23,"mat-form-field",13),d.Ub(24,"mat-label"),d.Dc(25),d.Tb(),d.Pb(26,"input",14),d.Bc(27,S,2,2,"mat-hint",15),d.Tb(),d.Tb(),d.Ub(28,"div",12),d.Ub(29,"mat-form-field",13),d.Ub(30,"mat-label"),d.Dc(31),d.Tb(),d.Pb(32,"input",16),d.Tb(),d.Tb(),d.Ub(33,"div",12),d.Ub(34,"mat-form-field",13),d.Ub(35,"mat-label"),d.Dc(36),d.Tb(),d.Pb(37,"input",17),d.Bc(38,L,2,2,"mat-hint",15),d.Tb(),d.Tb(),d.Ub(39,"div",12),d.Ub(40,"mat-form-field",13),d.Ub(41,"mat-label"),d.Dc(42),d.Tb(),d.Pb(43,"input",18),d.Bc(44,j,2,2,"mat-hint",19),d.Tb(),d.Tb(),d.Tb(),d.Tb(),d.Tb(),d.Tb(),d.Tb(),d.Bc(45,x,2,2,"mat-checkbox",20),d.Bc(46,B,4,4,"div",21),d.Rb()}if(2&e){var r=t.ngIf,i=d.gc();d.Cb(1),d.mc("readonly",d.ic(2,22,i.loading$))("title",r.register),d.Cb(3),d.mc("linear",!0),d.Cb(3),d.mc("stepControl",i.certificateForm),d.Cb(2),d.mc("formGroup",i.certificateForm),d.Cb(2),d.mc("stepControl",i.registerForm),d.Cb(3),d.Hc(" ",i.lastName().value," ",i.firstName().value," ",i.middleName().value," "),d.Cb(2),d.Ec(i.iin().value),d.Cb(2),d.Ec(i.certificateDateRange()),d.Cb(2),d.mc("formGroup",i.registerForm),d.Cb(5),d.Ec(r.email),d.Cb(2),d.mc("ngIf",i.email().errors&&i.email().errors.email),d.Cb(4),d.Ec(r.phone),d.Cb(1),d.mc("showMaskTyped",!0),d.Cb(4),d.Ec(r.password),d.Cb(2),d.mc("ngIf",i.password().errors&&i.password().errors.invalidPassword),d.Cb(4),d.Ec(r.confirmPassword),d.Cb(2),d.mc("ngIf",i.confirmPassword().touched&&i.confirmPassword().value!==i.password().value),d.Cb(1),d.mc("ngIf",1===i.selectedIndex),d.Cb(1),d.mc("ngIf",1===i.selectedIndex)}}var $,q=(($=function(){function e(t,a,s,d,g,p,v){var h=this;_classCallCheck(this,e),this.fb=t,this.snackbar=a,this.authService=s,this.locale=d,this.ref=g,this.dialog=p,this.loader=v,this.loading$$=new n.a(!1),this.loading$=this.loading$$.asObservable(),this.certLoading=!1,this.personalDataUsage=new r.e(!1),this.agreementSubsciption=null,this.registerSubsciption=null,this._agreement=function(){null!==h.agreementSubsciption&&h.agreementSubsciption.unsubscribe(),h.agreementSubsciption=h.dialog.open(b.a,{disableClose:!0,hasBackdrop:!0,autoFocus:!0,panelClass:["d-lg","xl-md"],data:{method:h.loader.loadAgreementComponent,iin:h.iin().value,lastName:h.lastName().value,firstName:h.firstName().value,middleName:h.middleName().value}}).afterClosed().subscribe((function(e){e?(h.agreementId().setValue(e),h.personalDataUsage.setValue(!0)):h.personalDataUsage.setValue(!1)}))},this.certificateLoaded=function(e,t){h.responseObject().setValue(e),h._mapToFormValues(t)},this.register=function(){if(!h.personalDataUsage.value||""===h.agreementId().value)return h.snackbar.open(h._personalDataUsageMessage);h.registerForm.valid?(null!==h.registerSubsciption&&h.registerSubsciption.unsubscribe(),h._setLoading(!0),h.registerSubsciption=h.authService.registerUser(h.registerForm.value).pipe(Object(i.a)((function(e){h.snackbar.open(h._successMessage),h.ref.close()}))).subscribe(c.a,(function(){h._setLoading(!1)}))):h.registerForm.markAllAsTouched()},this.responseObject=function(){return h.certificateForm.get("responseObject")},this.iin=function(){return h.registerForm.get("identifier")},this.email=function(){return h.registerForm.get("email")},this.lastName=function(){return h.registerForm.get("lastName")},this.firstName=function(){return h.registerForm.get("firstName")},this.middleName=function(){return h.registerForm.get("middleName")},this.password=function(){return h.registerForm.get("password")},this.confirmPassword=function(){return h.registerForm.get("confirmPassword")},this.agreementId=function(){return h.registerForm.get("agreementId")},this.certificateDateTo=function(){return h.registerForm.get("certificateDateTo")},this.certificateDateFrom=function(){return h.registerForm.get("certificateDateFrom")},this.certificateDateRange=function(){var e=h.certificateDateFrom().value,t=h.certificateDateTo().value;return e&&t?"".concat(Object(o.u)(e,"dd/MM/yy","en")," - ").concat(Object(o.u)(t,"dd/MM/yy","en")):""},this._initializeForms=function(){h.certificateForm=h.fb.group({responseObject:["",r.u.required]}),h.registerForm=h.fb.group({identifier:["",Object(f.a)()],lastName:[""],firstName:["",r.u.required],middleName:[""],email:["",[r.u.required,r.u.email]],phoneNumber:["",r.u.required],password:["",l(8)],confirmPassword:["",r.u.required],certificateDateFrom:["",r.u.required],certificateDateTo:["",r.u.required],essenceType:["",r.u.required],agreementId:["",r.u.required]})},this._mapToFormValues=function(e){var t=function(e){var t,a=e.subjectDn,r=e.certNotAfter,i=e.certNotBefore;if(a){var n=a.split(","),c=m(n,"CN=");return{identifier:m(n,"SERIALNUMBER=IIN"),middleName:m(n,"G="),lastName:m(n,"SURNAME="),firstName:c?c.split(" ")[1]:"",email:null===(t=m(n,"E="))||void 0===t?void 0:t.toLowerCase(),certificateDateFrom:i?new Date(+i):null,certificateDateTo:r?new Date(+r):null,essenceType:u.b.Individual}}}(h.responseObject().value);h.registerForm.patchValue(t),h.responseObject().valid&&e&&e.next()}}return _createClass(e,[{key:"ngOnInit",value:function(){var e=this;this._initializeForms(),this.locale$=this.locale.register().pipe(Object(i.a)((function(t){return e._successMessage=t.success,e._personalDataUsageMessage=t.personalDataUsage,t})))}},{key:"_setLoading",value:function(e){this.loading$$.next(e)}}]),e}()).\u0275fac=function(e){return new(e||$)(d.Ob(r.d),d.Ob(g.b),d.Ob(p.a),d.Ob(v.a),d.Ob(h.h),d.Ob(h.c),d.Ob(C.a))},$.\u0275cmp=d.Ib({type:$,selectors:[["app-okaps-register"]],decls:2,vars:3,consts:[[4,"ngIf"],[3,"readonly","title"],["mat-dialog-content","",1,"px-0","position-relative"],[3,"linear","selectionChange"],["stepper",""],["matStepperIcon","edit"],[3,"stepControl"],["matStepLabel",""],["autocomplete","off",3,"formGroup"],[3,"certificateLoading","certificateLoaded"],["autocomplete","off",3,"formGroup","ngSubmit"],[1,"row","mt-3"],[1,"col-12","mb-2"],["appearance","fill"],["autocomplete","email","type","email","matInput","","formControlName","email"],["align","end","class","warn",4,"ngIf"],["matInput","","formControlName","phoneNumber","mask","(000) 000 00 00","prefix","+7",3,"showMaskTyped"],["autocomplete","new-password","type","password","matInput","","formControlName","password"],["autocomplete","new-password","type","password","matInput","","formControlName","confirmPassword"],["class","warn","align","end",4,"ngIf"],[3,"formControl","click",4,"ngIf"],["mat-dialog-actions","","class","mb-2",4,"ngIf"],["align","end",1,"warn"],[3,"formControl","click"],["mat-dialog-actions","",1,"mb-2"],["mat-flat-button","","color","primary","type","button",1,"w-xs-100",3,"disabled","click"]],template:function(e,t){1&e&&(d.Bc(0,M,47,24,"ng-container",0),d.hc(1,"async")),2&e&&d.mc("ngIf",d.ic(1,1,t.locale$))},directives:[o.l,w.a,h.f,T.e,T.c,T.a,T.b,r.v,r.p,r.i,I.a,U.a,D.b,D.f,F.b,r.b,r.o,r.g,N.a,k.a,D.e,y.a,r.f,h.d,O.b],pipes:[o.b],styles:[""],data:{animation:[s.b]}}),$)}}]);